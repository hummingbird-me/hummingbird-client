{{#bootstrap/bs-modal class="ticket-modal" onClose=onClose as |modal|}}
  {{#modal.body}}
    <div class="ticket">
      {{! header }}
      {{#unless isPersonalTicket}}
      <div class="ticket-header clearfix">
        {{lazy-image src=(image ticket.user.avatar "small") class="pull-sm-left"}}
        <div class="ticket-about">
            <div class="ticket-with">
              {{t-html "groups.tickets.conversation.title"
                name=ticket.user.name
                link=(href-to "users.index" ticket.user.name)}}
            </div>
            <div class="ticket-actions">
              <a href="#" class="resolve-ticket" {{action "markResolved"}}>
                {{t "groups.tickets.conversation.mark-resolved"}}
              </a>
              <a href="#" class="close-ticket" {{action "markClosed"}}>
                {{t "groups.tickets.conversation.mark-closed"}}
              </a>
            </div>
          </div>
        </div>
      {{/unless}}

      {{! conversation list }}
      <div class="ticket-history">
        <ul class="ticket-history-list">
          {{#each (reject-by "isNew" true ticket.messages) as |message|}}
            {{groups/tickets/ticket-conversation-message
              ticket=ticket
              message=message
              class="clearfix"
              tagName="li"}}
          {{/each}}
          {{#if (and isNewTicket ticket.isNew)}}
            <li class="card">
              <div class="card-block">
                {{t "groups.tickets.conversation.helper"}}
              </div>
            </li>
          {{/if}}
        </ul>
      </div>

      {{! footer }}
      <div class="ticket-message clearfix">
        {{! only show if within dashboard }}
        {{#unless isPersonalTicket}}
          <nav class="nav">
            <a class="nav-link {{if (eq activeTab "message") "active"}}" href="#" {{action (action (mut activeTab) "message")}}>
              {{t "groups.tickets.conversation.nav.reply"}}
            </a>
            <a class="nav-link {{if (eq activeTab "mod_note") "active"}}" href="#" {{action (action (mut activeTab) "mod_note")}}>
              {{t "groups.tickets.conversation.nav.leader"}}
            </a>
          </nav>
        {{/unless}}
        {{expanding-textarea replyContent
          update=(action (mut replyContent))
          keyEvents=(hash
            13=(action "onEnter")
          )
          placeholder=(t "groups.tickets.conversation.reply-placeholder")
          class="ticket-input"}}
        <button disabled={{if postMessageTask.isRunning "disabled"}} onclick={{perform postMessageTask}}>
          {{#if postMessageTask.isRunning}}
            {{loading-spinner size="small"}}
          {{else}}
            {{#if isNewTicket}}
              {{t "groups.tickets.conversation.create-btn"}}
            {{else}}
              {{t "groups.tickets.conversation.reply-btn"}}
            {{/if}}
          {{/if}}
        </button>
      </div>
    </div>
  {{/modal.body}}
{{/bootstrap/bs-modal}}
